
import { jsPDF } from "jspdf";

export const generatePDF = (title: string, content: string, courseCode: string, year: number) => {
  const doc = new jsPDF();
  const pageWidth = doc.internal.pageSize.getWidth();
  const margin = 20;
  const maxLineWidth = pageWidth - margin * 2;

  // Header
  doc.setFontSize(16);
  doc.setFont("helvetica", "bold");
  doc.text("ADEKUNLE AJASIN UNIVERSITY, AKUNGBA-AKOKO", pageWidth / 2, 20, { align: "center" });
  
  doc.setFontSize(14);
  doc.text("FINANCE STUDENTS' ASSOCIATION", pageWidth / 2, 28, { align: "center" });

  doc.setLineWidth(0.5);
  doc.line(margin, 35, pageWidth - margin, 35);

  // Course Info
  doc.setFontSize(12);
  doc.setFont("helvetica", "normal");
  doc.text(`Course Code: ${courseCode}`, margin, 45);
  doc.text(`Year: ${year}`, pageWidth - margin - 30, 45); // Approximate right align
  
  doc.setFont("helvetica", "bold");
  doc.text(`Course Title: ${title}`, margin, 52);

  doc.line(margin, 58, pageWidth - margin, 58);

  // Content
  doc.setFont("helvetica", "normal");
  doc.setFontSize(11);

  const splitText = doc.splitTextToSize(content, maxLineWidth);
  doc.text(splitText, margin, 68);

  // Footer
  // Use 'any' cast to bypass strict type checking on internal properties if types are mismatched
  const pageCount = (doc as any).internal.getNumberOfPages();
  for(let i = 1; i <= pageCount; i++) {
      doc.setPage(i);
      doc.setFontSize(10);
      doc.text(`Page ${i}`, pageWidth / 2, doc.internal.pageSize.getHeight() - 10, { align: "center" });
      doc.text("Generated by FINSA Portal AI", margin, doc.internal.pageSize.getHeight() - 10);
  }

  return doc;
};

export const downloadPDF = (title: string, content: string, courseCode: string, year: number) => {
    const doc = generatePDF(title, content, courseCode, year);
    doc.save(`${courseCode}_${year}_PastQuestion.pdf`);
};

export const openPDFPreview = (title: string, content: string, courseCode: string, year: number) => {
    const doc = generatePDF(title, content, courseCode, year);
    const pdfBlob = doc.output('blob');
    const blobUrl = URL.createObjectURL(pdfBlob);
    window.open(blobUrl, '_blank');
};
